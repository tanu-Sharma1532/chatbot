<!DOCTYPE html>
<html>
<head>
    <title>Zulu Club Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        h3 {
            color: #444;
            margin: 20px 0 10px 0;
        }
        .main-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        .main-buttons button {
            padding: 15px 25px;
            font-size: 16px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .main-buttons button:hover {
            background: #45a049;
        }
        .cache-controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        .cache-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        .cache-buttons button {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        .clear-btn {
            background: #f44336;
            color: white;
        }
        .control-panel {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }
        .control-panel button {
            padding: 12px 25px;
            font-size: 16px;
        }
        .clear-all {
            background: #ff9800;
            color: white;
        }
        .check-status {
            background: #9C27B0;
            color: white;
        }
        #message {
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            text-align: center;
            font-weight: bold;
        }
        #cacheStatus {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        #cacheStatus ul {
            list-style: none;
            padding: 0;
        }
        #cacheStatus li {
            padding: 8px;
            margin: 5px 0;
            background: #f9f9f9;
            border-radius: 4px;
        }
        hr {
            margin: 30px 0;
            border: none;
            border-top: 2px solid #ddd;
        }
        @media (max-width: 768px) {
            body {
                margin: 20px;
            }
            .main-buttons {
                flex-direction: column;
                align-items: center;
            }
            .main-buttons button {
                width: 100%;
                max-width: 300px;
            }
        }
        table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  background: white;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  border-radius: 5px;
  overflow: hidden;
}

th {
  background: #4CAF50;
  color: white;
  padding: 12px 15px;
  text-align: left;
  font-weight: bold;
}

td {
  padding: 12px 15px;
  border-bottom: 1px solid #eee;
}

tr:hover {
  background-color: #f5f5f5;
}

tr:last-child td {
  border-bottom: none;
}
    </style>
</head>
<body>
    <h1>Zulu Club Dashboard</h1>
    
<div class="main-buttons">
    <button onclick="location.href='/products'">Products</button>
    <button onclick="location.href='/productscards'">Products Cards</button>
    <button onclick="location.href='/sellers'">Sellers</button>
    <button onclick="location.href='/videos'">Videos</button>
    <button onclick="location.href='/videoscards'">Videos Cards</button>
    <button onclick="location.href='/users'">Users</button>
    <button onclick="location.href='/galleries'">Galleries</button>
    <button onclick="location.href='/appconfigs'">App Configs</button>
    <button onclick="location.href='/categories'">Categories</button>
    <button onclick="location.href='/chat'">Chatbot</button>
</div>
    
    <hr>
    
    <div class="cache-controls">
        <h3>Cache Controls</h3>
        <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
            Data is cached for 2 hours. Clear cache to force fresh data from database.<br>
            Database connection automatically closes after 5 minutes of inactivity.
        </p>
        
<div class="cache-buttons">
    <button class="clear-btn" onclick="clearCache('products')">üóëÔ∏è Clear Products Cache</button>
    <button class="clear-btn" onclick="clearCache('sellers')">üóëÔ∏è Clear Sellers Cache</button>
    <button class="clear-btn" onclick="clearCache('videos')">üóëÔ∏è Clear Videos Cache</button>
    <button class="clear-btn" onclick="clearCache('users')">üóëÔ∏è Clear Users Cache</button>
    <button class="clear-btn" onclick="clearCache('galleries')">üóëÔ∏è Clear Galleries Cache</button>
    <button class="clear-btn" onclick="getProductStats()">üìä Product Stats by Updater</button>
</div>
        
        <div class="control-panel">
            <button class="clear-all" onclick="clearAllCache()">üî• Clear All Caches</button>
            <button class="check-status" onclick="checkCacheStatus()">üîç Check Cache Status</button>
        </div>
    </div>
    
    <div id="message"></div>
    <div id="cacheStatus" style="margin-top: 20px;"></div>

    <script>
        async function clearCache(type) {
            try {
                const response = await fetch(`/api/clear-cache/${type}`, { method: 'POST' });
                const data = await response.json();
                
                if (data.success) {
                    showMessage(`‚úÖ ${data.message}`, 'success');
                } else {
                    showMessage(`‚ùå Error: ${data.error}`, 'error');
                }
            } catch (error) {
                showMessage(`‚ùå Network error: ${error.message}`, 'error');
            }
        }
        
        async function clearAllCache() {
            try {
                const response = await fetch('/api/clear-cache/all', { method: 'POST' });
                const data = await response.json();
                
                if (data.success) {
                    showMessage(`‚úÖ ${data.message}`, 'success');
                } else {
                    showMessage(`‚ùå Error: ${data.error}`, 'error');
                }
            } catch (error) {
                showMessage(`‚ùå Network error: ${error.message}`, 'error');
            }
        }
        
        async function checkCacheStatus() {
    try {
        const response = await fetch('/api/cache-status');
        const data = await response.json();
        
        if (data.success) {
            let html = '<h4>Cache Status (2 hours TTL):</h4><ul>';
            
            Object.keys(data.cacheStatus).forEach(key => {
                if (key !== 'connection') {
                    const status = data.cacheStatus[key];
                    const cacheType = key.charAt(0).toUpperCase() + key.slice(1);
                    
                    html += `<li>${cacheType}: `;
                    if (status.cached) {
                        html += `‚úÖ Cached (${status.dataCount} records, ${Math.floor(status.age/60)} min old)`;
                    } else {
                        html += `‚ùå Not cached`;
                    }
                    html += `</li>`;
                }
            });
            
            // Add connection status
            const conn = data.cacheStatus.connection;
            html += '<hr style="margin: 15px 0;">';
            html += '<h4>Database Connection:</h4>';
            html += `<li>Status: ${conn.active ? '‚úÖ Active' : '‚ùå Closed'}</li>`;
            if (conn.active) {
                html += `<li>Idle for: ${conn.idleTime} seconds</li>`;
            }
            html += `<li>Auto-close: After 5 minutes idle</li>`;
            
            html += '</ul>';
            document.getElementById('cacheStatus').innerHTML = html;
        }
    } catch (error) {
        showMessage(`‚ùå Error checking cache: ${error.message}`, 'error');
    }
}
        
        function showMessage(text, type = 'success') {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.style.color = type === 'error' ? '#721c24' : '#155724';
            messageDiv.style.background = type === 'error' ? '#f8d7da' : '#d4edda';
            messageDiv.style.border = `1px solid ${type === 'error' ? '#f5c6cb' : '#c3e6cb'}`;
            
            setTimeout(() => {
                messageDiv.textContent = '';
                messageDiv.style.background = '';
                messageDiv.style.border = 'none';
            }, 5000);
        }
        // In index.html, add this function to the script section:
async function getProductStats() {
  try {
    const response = await fetch('/api/product-stats-by-updater');
    const data = await response.json();
    
    if (data.success) {
      // Format the data as a table
      let html = '<h4>Product Stats by Updater:</h4>';
      html += '<p>Showing who updated products and how many:</p>';
      
      if (data.data.length === 0) {
        html += '<p>No data available.</p>';
      } else {
        html += '<table style="width:100%; border-collapse:collapse; margin-top:20px;">';
        html += '<thead><tr style="background:#4CAF50; color:white;">';
        html += '<th style="padding:10px; text-align:left;">Updater</th>';
        html += '<th style="padding:10px; text-align:left;">Total Products</th>';
        html += '</tr></thead>';
        html += '<tbody>';
        
        data.data.forEach(item => {
          html += '<tr style="border-bottom:1px solid #ddd;">';
          html += `<td style="padding:10px;">${item.Updated_by || 'Unknown'}</td>`;
          html += `<td style="padding:10px;">${item.total_products}</td>`;
          html += '</tr>';
        });
        
        html += '</tbody>';
        html += '</table>';
        html += `<p style="margin-top:10px; color:#666;">Total updaters: ${data.count}</p>`;
      }
      
      // Display in the cacheStatus div
      document.getElementById('cacheStatus').innerHTML = html;
      showMessage('‚úÖ Product stats loaded successfully', 'success');
    } else {
      showMessage(`‚ùå Error: ${data.error}`, 'error');
    }
  } catch (error) {
    showMessage(`‚ùå Network error: ${error.message}`, 'error');
  }
}
    </script>
</body>
</html>